From 1bdc3c58e7ad8da51f0aed6711a096bac48b168b Mon Sep 17 00:00:00 2001
From: Peter Hutterer <peter.hutterer@who-t.net>
Date: Tue, 19 Jul 2011 10:54:59 +1000
Subject: [PATCH 3/3] Test the device in PreInit and fail if it cannot be
 opened.

Signed-off-by: Peter Hutterer <peter.hutterer@who-t.net>
---
 src/xf86Elo.c |    9 +++++++++
 1 files changed, 9 insertions(+), 0 deletions(-)

diff --git a/src/xf86Elo.c b/src/xf86Elo.c
index 4e9296e..2b09bdc 100644
--- a/src/xf86Elo.c
+++ b/src/xf86Elo.c
@@ -945,7 +945,16 @@ xf86EloInit(InputDriverPtr	drv,
     xf86Msg(X_ERROR, "%s: No Device specified in Elographics module config.\n",
 	    pInfo->name);
     return BadValue;
+  } else {
+      pInfo->fd = xf86OpenSerial(pInfo->options);
+      if (pInfo->fd < 0) {
+	xf86Msg(X_ERROR, "%s: Unable to open Elographics touchscreen device %s", pInfo->name, str);
+	return BadValue;
+      }
+      xf86CloseSerial(pInfo->fd);
+      pInfo->fd = -1;
   }
+
   priv->input_dev = strdup(str);
 
   opt_model = xf86SetStrOption(pInfo->options, "Model", NULL);
-- 
1.7.6

